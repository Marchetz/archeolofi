<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <title></title>
        <link rel="stylesheet" type="text/css" href="libs/jquery.mobile-1.4.2/jquery.mobile-1.4.2.css">
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script src="libs/jquery-1.11.1.min.js"></script>
	    <script src="libs/jquery.mobile-1.4.2/jquery.mobile-1.4.2.js"></script>
        <script type="text/javascript" src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        
        
        <!-- <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; minimum-scale=1.0; user-scalable=no; target-densityDpi=device-dpi" /> -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    </head>
    <body>
        
        <div data-role="page" id="home"  >
            <div data-role="header" data-position="inline">
                <h1>Pagina principale</h1>
                <a href="#login" data-role="button" class="ui-btn-right" >Login</a>
            </div>
            
            <div data-role="content" >
               <div id="map" class="map" ></div>
                
                <script>
                    /* var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                    osmAttrib = '&copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    osm = L.tileLayer(osmUrl, {maxZoom: 18, attribution: osmAttrib}); */
                    
                    var map = L.map('map')

                    L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
                                maxZoom: 25
                    }).addTo(map);
                    
                   
                    map.locate({setView: true, maxZoom: 16});
                    
                    function onLocationFound(e) {
                        var radius = e.accuracy / 2;

                        L.circle(e.latlng, radius).addTo(map).bindPopup("You are within " + radius + " meters from this point").openPopup();
                        console.log(e);
                    }
                    
                    
                    map.on('locationfound', onLocationFound);
                    
                    function onLocationError(e) {
                        alert(e.message);
                    }

                    map.on('locationerror', onLocationError);
                    
                 
                    </script>
                    <script type="text/javascript" src="punti_coordinate.js"></script>
                    <script type="text/javascript" src="aree_coordinate.js"></script>
                    <script> 
                    
                    var point_style = {
                        radius: 8,
                        fillColor: "#ff7800",
                        color: "#000",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.8
                        
                    }
                        
                    var area_style = {
                        "color": "#993300"
                        
                        
                    };
                    
                    function descrition_popup_punto(feature, layer) {
                        
                        var feat = feature;
                        
                        layer.bindPopup( "DESCRIZIONE: " + feat.properties.descrizion + " " + "LUOGO: " + feature.properties.luogo + '<a href="#info" >   More info</a>' );   
                        
                    }
                    function descrition_popup_area(feature, layer) {
                        
                        layer.bindPopup( "LOCALIZZAZIONE: " + feature.properties.localizzaz + " " + "TIPO SCAVO: " + feature.properties.tipo_scavo + '<a href="#info">   More info</a>');
                        
                    } 
                        
                
                  
                    
                    L.geoJson(area, { 
                        style: area_style,
                        onEachFeature: descrition_popup_area,
                                                                    
                                        }).addTo(map);
                    
                    L.geoJson(punti, {
                        onEachFeature: descrition_popup_punto,
                        pointToLayer: function( feature,latlng) {
                                                return L.circleMarker(latlng, point_style); } 
                                    }).addTo(map);
                    
                    </script>
                </div>    
        </div>
        
        
        
       
        
        <div data-role="page" id="info">
            <div data-role="header" >
                <h1>Info</h1>
                <a href="#home">Map</a>
            </div>

            
            <div data role="content">
                
                <div data-role="collapsible-set">
                    <div data-role="collapsible" data-collapsed="false">
                        <h3></h3>
                        <p><script>document.write();</script></p>
                    </div>
                    
                    <div data-role="collapsible" >
                        <h3>informazioni prese dal sito</h3>
                        <p>info archeologiche del sito</p>
                    </div>
                    
                    <div data-role="collapsible" >
                        <h3>commenti utenti</h3>
                        <p>puoi scrivere un tuo commento e mettere una foto</p>
                    </div>
                </div>
            
            
            </div>
            
        
        </div>
        
        <div data-role="page" id="login">
            <div data-role="header" >
                <a href="#home">Map</a>
                
                <h2>Login</h2>
                
                
            </div>
            <div data role="content">
                <form name= "login" >
                    <div data-role="fieldcontain" class="ui-hide-label">
                        <label for="username">Username:</label>
                        <input type="text" name="username" id="nome" value="" placeholder="Username"/>
                    </div>

                    <div data-role="fieldcontain" class="ui-hide-label">
                        <label for="password">Passord:</label>
                        <input type="text" name="password" id="password" value="" placeholder="Password"/>
                    </div>

                    <input type="button" id="bottone_login" data-icon="check" value="Login">    
                
                    <div data-role="collapsible" data-collapsed="true" data-theme="a">
                        <h3>Se non sei ancora registrato inserisci anche la tua e-mail </h3>

                        <div data-role="fieldcontain" class="ui-hide-label">
                            <label for="e-mail">E-mail:</label>
                            <input type="text" name="e-mail" id="e-mail" value="" placeholder="e-mail"/>
                        </div>
                        
                        <input type="button" id="bottone_register" data-icon="edit" value="Register">

                    </div>
                </form>
                
                <script>
                    $(document).ready( function() {
                        $("#bottone_login").click( function() {
                            
                            var nome = $("#nome").val();
                            var password = $("#password").val();
                            var user = [{ "name": nome, "pass": password }];
                            
                            $.ajax({
                                type:"POST",
                                url: "....",
                                data: { "user": JSON.stringify({  "user": user})},
                                datatype: "JSON",
                                success: function(data) { console.log(data.objects); },
                                error: function()
                                  {
                                    alert("CHE CAZZO FAIII????");
                                  }
                            });
                            
                            
                            
                        });
                    });
                    
                    
                    
                    
                    $(document).ready( function() {
                        $("#bottone_register").click( function() {
                            
                            var nome = $("#nome").val();
                            var password = $("#password").val();
                            var email = $("#e-mail").val();
                            var prova= JSON.stringify({ "name": nome, "password": password, "email": email });
                            alert(password);
                            alert( prova);
                           
                            
                            $.ajax({
                                type:"POST",
                                url: "http://0.0.0.0:5000/api/indiana_user",
                                data: prova,
                                dataType: "json",
                                contentType: "application/json",
                                success: function(data) { alert("ok"); },
                                error: function()
                                  {
                                    alert("CHE CAZZO FAIII????");
                                  }
                            });
                            
                            
                            
                        });
                    });
                    
                    
                    /*
                    "q": JSON.stringify({[ 
                                    "username": nome,
                                    "password": password,
                                    "email": email
                                                             ]})}
                    
                    
                    
                    */
                </script>
                
                
                
                
                
                
                
            
            
            </div>
            
        
        </div>
        
        
        
    
        
        
        
        
        
        
    </body>
    
    
    
    
   